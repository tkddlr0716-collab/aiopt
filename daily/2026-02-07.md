# AIOpt Daily — 2026-02-07

## Tracker (TaskTracker:3003 / aiopt-v02-*)
Format: `id | title | status | owner | started_at | last_proof_at | next_action | proof_link`

- aiopt-v02-T1 | CLI: install/doctor 명령 구현 | DONE | openclaw | 2026-02-07 18:10 KST | 2026-02-07 18:33 KST | (done) | logs:daily/2026-02-07.md#t1
- aiopt-v02-T2 | Wrapper(guard) 구현 | DONE | openclaw | 2026-02-07 18:32 KST | 2026-02-07 18:52 KST | (done) | logs:daily/2026-02-07.md#t2
- aiopt-v02-T3 | scan: 해결책 생성기 업그레이드 | IN_PROGRESS | openclaw | 2026-02-07 18:53 KST | 2026-02-07 18:56 KST | Add minimal "solution generator" fields (recommendations + patch stubs) | logs:daily/2026-02-07.md#t3
- aiopt-v02-T4 | Savings Simulator 리팩터 | TODO | openclaw | - | - | After T3 | -
- aiopt-v02-T5 | 바이브코더 데모(5분 체험) 문서/스크립트 | TODO | openclaw | - | - | After T4 | -

---

## [T0] TRIAGE / BASELINE
### Current repo
- Repo: https://github.com/tkddlr0716-collab/aiopt
- npm: https://www.npmjs.com/package/aiopt (published: 0.0.1)

### Folder tree (maxdepth=2, important files)
- `.github/workflows/ci.yml` (CI smoke)
- `dist/cli.js` (built CLI entry)
- `src/cli.ts` (commander commands)
- `src/scan.ts` (analysis + savings + policy generator)
- `src/cost.ts` (rate table lookup + per-event cost)
- `rates/rate_table.json` (subset table + estimated fallbacks)
- `samples/sample_usage.jsonl` (5-line sample)

### Current CLI commands
From `node dist/cli.js --help`:
- `aiopt init`
- `aiopt scan --input <path> --out <dir>`
- `aiopt policy --input <path> --out <dir>`

### Current outputs (scan)
Running:
- `node dist/cli.js scan --input ./aiopt-input/usage.jsonl`

Produces:
- `./aiopt-output/analysis.json`
- `./aiopt-output/report.txt`
- `./aiopt-output/cost-policy.json`

Sample report.txt (verbatim):
- 총비용: $0.23
- 절감 가능 금액(Estimated): $0.21
- 근거:
  - 모델 라우팅 절감(추정): $0.07
  - 컨텍스트 감축(추정): $0.02 (상위 20% input에 25% 감축 가정)
  - 재시도/오류 낭비: $0.13 (retries 기반)

### Why scan output is “숫자 3줄” + calculation flow
- `scan.ts` currently computes 3 savings levers and prints them as 3 lines in `report.txt`:
  1) **Routing savings (rule-based)**: if `feature_tag` in {summarize,classify,translate}, compare current model cost vs cheapest known model within the same provider. Unknown models are excluded from routing.
  2) **Context reduction estimate (deterministic)**: take top 20% events by `input_tokens`, assume 25% input reduction, save = reduced_tokens * input_rate.
  3) **Retry waste**: `retries>=1` → wasted = base_cost_per_call * retries (currently not trace_id-based).
- Total cost is sum of per-event cost (either `billed_cost` if present, else rate_table or estimated fallback).

### Proof
- Log proof: captured command help + scan outputs in this Daily.
- Files generated: `aiopt-output/{analysis.json,report.txt,cost-policy.json}`.

### Next action
- Finish T0 by adding a short note: what’s missing for v0.2 (install/doctor + wrapper/guard + scan as solution generator).
- Then start T1 (set IN_PROGRESS) with DoD check.

## [T1] install/doctor progress (proof)
- `npm run build` OK
- `node dist/cli.js install --force` OK (created aiopt/ + policies + usage.jsonl)
- `node dist/cli.js doctor` OK (checks + last5)

Created paths (sample run):
- aiopt/README.md
- aiopt/aiopt.config.json
- aiopt/policies/{routing.json,retry.json,output.json,context.json}
- aiopt/aiopt-wrapper.ts
- aiopt-output/usage.jsonl

---

## Runloop — 2026-02-07 18:32~18:40 KST
### Task status
- aiopt-v02-T2 kept **IN_PROGRESS** (progress 35%).
- Fixed tracker invariant: only one task in_progress → parked `aiopt-00-parent` to pending.

### Work done (T2 wrapper template)
- Replaced `aiopt/aiopt-wrapper.ts` install template from skeleton → real guardrail wrapper:
  - loads `aiopt/aiopt.config.json`
  - loads `aiopt/policies/{routing,retry,output,context}.json`
  - deterministic routing (feature_tag → cheap tier)
  - output cap enforcement via policy
  - retry/backoff policy (status: error/timeout)
  - JSONL usage logging (required schema) to `aiopt-output/usage.jsonl`

### Proof
- Commit: b896a90c9ad02da598b81403225cbad9d4e1c8a9 (pushed to origin/main)
- `git show --stat -1`:
  - b896a90 feat(v0.2): implement wrapper template (config/policies/logging/retry/caps)
  - dist/cli.js | 290 insertions(+), …
  - src/install.ts | 291 insertions(+), …
  - package-lock.json updated (tsup now installed)

### Local verification logs
- Build:
  - `npm run build` → OK
- Install smoke:
  - `cd /tmp/aiopt-wraptest && node dist/cli.js install --force`
  - Output:
    - CREATED: aiopt/README.md
    - CREATED: aiopt/aiopt.config.json
    - CREATED: aiopt/policies/routing.json
    - CREATED: aiopt/policies/retry.json
    - CREATED: aiopt/policies/output.json
    - CREATED: aiopt/policies/context.json
    - CREATED: aiopt/aiopt-wrapper.ts
    - CREATED: aiopt-output/usage.jsonl

### Next
- Fill remaining DoD gaps for T2.2~T2.4:
  - wrapper should derive tokens/cost from `exec()` result when available (not only from req)
  - log `routed_from` always when model changes (already)
  - explicit idempotency semantics + attempt>=2 logging verified

---

## Runloop — 2026-02-07 18:44~18:58 KST
### Task status
- aiopt-v02-T2 → **DONE**
- aiopt-v02-T3 → **IN_PROGRESS** (started)

### Work done
#### [aiopt-v02-T2] Wrapper: usage/cost extraction from exec() result
- Added best-effort extraction from common SDK response shapes:
  - `res.usage.{prompt_tokens,completion_tokens,total_tokens}`
  - `res.cost_usd` / `res.costUSD` / `res.cost.usd`
- Wrapper now prefers observed usage/cost over request-provided fields for logging.

Proof:
- Commit: **711862f466e7f360c4e624769b02a4c4c0c3f6ad** (pushed)
- Smoke: `install --force` then `grep extractObservedUsage aiopt/aiopt-wrapper.ts` → line exists

#### [aiopt-v02-T3] scan: start solution-generator upgrade
- `scan` now emits `report.json` alongside `analysis.json`, `report.txt`, `cost-policy.json`.

Proof:
- Commit: **9cdfe219d1a1891cd03718c179164d3d32c287fa** (pushed)
- Local smoke:
  - `aiopt init` → `aiopt scan ...` → outputs include `report.json`

### Next
- T3: extend `report.json` to include explicit recommendations + patch stubs (still missing).
